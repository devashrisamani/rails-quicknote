<%# =========================================================================== %>
<%# NOTE PARTIAL - app/views/notes/_note.html.erb %>
<%# =========================================================================== %>
<%# This is a PARTIAL (notice the underscore _ in filename) %>
<%# Partials are reusable chunks of HTML %>
<%# %>
<%# This partial is used by: %>
<%#   - index.html.erb: render @notes (renders this for each note) %>
<%#   - Turbo Streams: when broadcasting new/updated notes %>
<%# %>
<%# Available variables: %>
<%#   note - A single Note object (passed automatically by render @notes) %>
<%# =========================================================================== %>

<%# TURBO FRAME - Enables partial page updates %>
<%# %>
<%# dom_id(note) generates a unique ID like "note_1", "note_2", etc. %>
<%# This ID is crucial for: %>
<%#   1. Turbo Streams to find and update this specific note %>
<%#   2. Inline editing to replace just this note with the edit form %>
<%# %>
<%# When you click Edit: %>
<%#   1. Turbo fetches /notes/1/edit %>
<%#   2. Finds <turbo-frame id="note_1"> in the response %>
<%#   3. Replaces THIS frame's content with the edit form %>
<%#   4. Rest of page stays unchanged! %>
<turbo-frame id="<%= dom_id(note) %>">

  <%# NOTE CARD %>
  <%# 'group' class enables group-hover: on children %>
  <%# When you hover the card, children with group-hover: classes activate %>
  <article class="group p-5 bg-white rounded-2xl border border-slate-100 shadow-sm hover:shadow-md hover:border-slate-200 transition-all duration-200">

    <%# TOP ROW: Title/date on left, buttons on right %>
    <div class="flex items-start justify-between gap-4">

      <%# LEFT SIDE: Title and timestamp %>
      <%# flex-1 makes this grow to fill available space %>
      <%# min-w-0 prevents text from overflowing %>
      <div class="flex-1 min-w-0">
        <h2 class="text-lg font-semibold text-slate-800 mb-1">
          <%# TITLE LINK - Clicking goes to show page %>
          <%# link_to note is shorthand for link_to note_path(note) %>
          <%= link_to note.title, note, class: "hover:text-amber-600 transition-colors" %>
        </h2>

        <%# TIMESTAMP %>
        <%# time_ago_in_words converts timestamps to "5 minutes", "2 days", etc. %>
        <%# datetime attribute helps screen readers and search engines %>
        <time class="text-xs text-slate-400 font-medium" datetime="<%= note.created_at.iso8601 %>">
          <%= time_ago_in_words(note.created_at) %> ago
        </time>
      </div>

      <%# RIGHT SIDE: Action buttons %>
      <%# opacity-0 group-hover:opacity-100 = hidden until card is hovered %>
      <div class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">

        <%# EDIT BUTTON %>
        <%# data: { turbo_frame: dom_id(note) } tells Turbo: %>
        <%#   "Load the response into the turbo-frame with this ID" %>
        <%# This enables INLINE EDITING without leaving the page! %>
        <%= link_to edit_note_path(note),
            class: "p-2 text-slate-400 hover:text-amber-600 hover:bg-amber-50 rounded-lg transition-colors",
            title: "Edit",
            data: { turbo_frame: dom_id(note) } do %>
          <%# Pencil icon %>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
        <% end %>

        <%# DELETE BUTTON %>
        <%# button_to creates a mini form (needed for DELETE requests) %>
        <%# %>
        <%# method: :delete - Uses HTTP DELETE method %>
        <%# form: { data: { turbo_confirm: "..." } } - Shows confirmation dialog %>
        <%# %>
        <%# When clicked: %>
        <%#   1. Browser shows "Delete this note?" confirmation %>
        <%#   2. If confirmed, sends DELETE request to /notes/1 %>
        <%#   3. Controller responds with turbo_stream.remove(@note) %>
        <%#   4. This entire turbo-frame disappears! (smooth delete) %>
        <%= button_to note_path(note),
            method: :delete,
            class: "p-2 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",
            title: "Delete",
            form: { data: { turbo_confirm: "Delete this note?" } } do %>
          <%# Trash icon %>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
            <line x1="10" y1="11" x2="10" y2="17"/>
            <line x1="14" y1="11" x2="14" y2="17"/>
          </svg>
        <% end %>
      </div>
    </div>

    <%# BODY PREVIEW - Only shown if note has body text %>
    <%# note.body.present? returns false for nil or empty string %>
    <% if note.body.present? %>
      <%# truncate cuts text at 150 chars and adds "..." %>
      <%# line-clamp-2 limits to 2 lines (CSS) %>
      <p class="mt-3 text-slate-600 line-clamp-2 text-sm leading-relaxed"><%= truncate(note.body, length: 150) %></p>
    <% end %>

  </article>
</turbo-frame>
