<%# =========================================================================== %>
<%# EDIT VIEW - app/views/notes/edit.html.erb %>
<%# =========================================================================== %>
<%# Shows the form for editing an existing note %>
<%# URL: /notes/:id/edit (e.g., /notes/1/edit) %>
<%# Controller action: NotesController#edit %>
<%# %>
<%# Available variables from controller: %>
<%#   @note - The existing Note object to edit (found by before_action) %>
<%# %>
<%# This view can be loaded two ways: %>
<%#   1. Full page load: User navigates to /notes/1/edit directly %>
<%#   2. Turbo Frame: User clicks Edit button, only frame content loads %>
<%# %>
<%# When form is submitted: %>
<%#   1. Browser sends PATCH request to /notes/1 %>
<%#   2. NotesController#update handles it %>
<%#   3. If valid: redirects to show page %>
<%#   4. If invalid: re-renders this page with errors %>
<%# =========================================================================== %>

<%# SET PAGE TITLE - Includes the note title %>
<% content_for :title, "Edit: #{@note.title}" %>

<div class="max-w-3xl mx-auto px-4 sm:px-6 py-8 sm:py-12">

  <%# BACK NAVIGATION %>
  <%# Only visible when page is loaded directly (not via Turbo Frame) %>
  <nav class="mb-8">
    <%= link_to notes_path, class: "inline-flex items-center gap-2 text-slate-500 hover:text-amber-600 font-medium transition-colors" do %>
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"/>
        <polyline points="12 19 5 12 12 5"/>
      </svg>
      Back to notes
    <% end %>
  </nav>

  <%# TURBO FRAME - CRITICAL for inline editing! %>
  <%# %>
  <%# This frame's ID MUST match the one in _note.html.erb and show.html.erb %>
  <%# When user clicks Edit: %>
  <%#   1. Browser requests /notes/1/edit %>
  <%#   2. Turbo looks for <turbo-frame id="note_1"> in response %>
  <%#   3. Only this frame's content replaces the original %>
  <%#   4. Everything OUTSIDE the frame (navigation, header) stays unchanged %>
  <%# %>
  <%# After saving: %>
  <%#   1. Controller redirects to show page %>
  <%#   2. Turbo loads show page's turbo-frame %>
  <%#   3. Edit form is replaced with updated note content %>
  <turbo-frame id="<%= dom_id(@note) %>">
    <div class="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
      <header class="px-6 sm:px-8 pt-6 sm:pt-8 pb-4 border-b border-slate-100">
        <h1 class="text-2xl sm:text-3xl font-bold text-slate-800">Edit Note</h1>
        <p class="text-slate-500 mt-1">Make changes to your note</p>
      </header>

      <div class="px-6 sm:px-8 py-6">
        <%# RENDER THE FORM PARTIAL %>
        <%# Same form partial as new.html.erb, but: %>
        <%#   - Fields are pre-filled with @note's current values %>
        <%#   - Submit button says "Save Changes" (note.persisted? is true) %>
        <%#   - Form submits to PATCH /notes/1 (not POST /notes) %>
        <%= render "form", note: @note %>

        <%# CANCEL LINK %>
        <%# Clicking this loads the show page back into the turbo-frame %>
        <%# data: { turbo_frame: dom_id(@note) } ensures it loads into this frame %>
        <div class="mt-4 pt-4 border-t border-slate-100">
          <%= link_to @note,
              class: "text-sm text-slate-500 hover:text-slate-700 transition-colors",
              data: { turbo_frame: dom_id(@note) } do %>
            Cancel editing
          <% end %>
        </div>
      </div>
    </div>
  </turbo-frame>
</div>
